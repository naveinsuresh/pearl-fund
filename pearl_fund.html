<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Navein Suresh &amp; Suryaveer Singh">
<meta name="dcterms.date" content="2024-03-19">

<title>Pearl Fund: Portfolio Anlaysis &amp; Optmization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pearl_fund_files/libs/clipboard/clipboard.min.js"></script>
<script src="pearl_fund_files/libs/quarto-html/quarto.js"></script>
<script src="pearl_fund_files/libs/quarto-html/popper.min.js"></script>
<script src="pearl_fund_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pearl_fund_files/libs/quarto-html/anchor.min.js"></script>
<link href="pearl_fund_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pearl_fund_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pearl_fund_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pearl_fund_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pearl_fund_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="pearl_fund_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="pearl_fund_files/libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="pearl_fund_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="pearl_fund_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="pearl_fund_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="pearl_fund_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="pearl_fund_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="pearl_fund_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#equity-analysis" id="toc-equity-analysis" class="nav-link" data-scroll-target="#equity-analysis">Equity Analysis</a>
  <ul class="collapse">
  <li><a href="#monthly-returns-table-view" id="toc-monthly-returns-table-view" class="nav-link" data-scroll-target="#monthly-returns-table-view">Monthly Returns (Table View)</a></li>
  <li><a href="#stock-growth-monthly-returns-graph-view" id="toc-stock-growth-monthly-returns-graph-view" class="nav-link" data-scroll-target="#stock-growth-monthly-returns-graph-view"><strong>Stock Growth &amp; Monthly Returns (Graph View)</strong></a></li>
  <li><a href="#statistical-metrics" id="toc-statistical-metrics" class="nav-link" data-scroll-target="#statistical-metrics">Statistical Metrics</a></li>
  </ul></li>
  <li><a href="#benchmark-performance" id="toc-benchmark-performance" class="nav-link" data-scroll-target="#benchmark-performance">Benchmark Performance</a></li>
  <li><a href="#portfolio-optimization" id="toc-portfolio-optimization" class="nav-link" data-scroll-target="#portfolio-optimization">Portfolio Optimization</a>
  <ul class="collapse">
  <li><a href="#optimized-portfolio-visualizations" id="toc-optimized-portfolio-visualizations" class="nav-link" data-scroll-target="#optimized-portfolio-visualizations">Optimized Portfolio Visualizations</a>
  <ul class="collapse">
  <li><a href="#fund-total-growth-return" id="toc-fund-total-growth-return" class="nav-link" data-scroll-target="#fund-total-growth-return">Fund Total Growth Return</a></li>
  <li><a href="#fund-monthly-returns" id="toc-fund-monthly-returns" class="nav-link" data-scroll-target="#fund-monthly-returns">Fund Monthly Returns</a></li>
  <li><a href="#annualized-returns" id="toc-annualized-returns" class="nav-link" data-scroll-target="#annualized-returns">Annualized Returns</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#comparative-statistical-analysis" id="toc-comparative-statistical-analysis" class="nav-link" data-scroll-target="#comparative-statistical-analysis">Comparative Statistical Analysis</a></li>
  <li><a href="#mean-variance-analysis-efficient-frontier" id="toc-mean-variance-analysis-efficient-frontier" class="nav-link" data-scroll-target="#mean-variance-analysis-efficient-frontier">Mean-Variance Analysis (Efficient Frontier)</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="pearl_fund.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pearl Fund: Portfolio Anlaysis &amp; Optmization</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Navein Suresh &amp; Suryaveer Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>In this project, our primary goal is to enhance the risk-adjusted returns of a carefully curated portfolio of stocks. The focus of our analysis is on a equity/fixed income portfolio, nicknamed ‚Äî ‚ÄúPearl Fund.‚Äù This portfolio comprises Stocks &amp; ETFs from a diverse array of industries and asset classes, namely:</p>
<ol type="1">
<li>Chevron Corporation (NYSE: CVX)</li>
<li>Costco Wholesale Corporation (NASDAQ: COST)</li>
<li>Ford Motor Company (NYSE: F)</li>
<li>HP Inc.&nbsp;(NYSE: HPQ)</li>
<li>Johnson &amp; Johnson (NYSE: JNJ)</li>
<li>JPMorgan Chase &amp; Co.&nbsp;(NYSE: JPM)</li>
<li>Microsoft Corporation (NASDAQ: MSFT)</li>
<li>PepsiCo, Inc.&nbsp;(NASDAQ: PEP)</li>
<li>Procter &amp; Gamble Company (NYSE: PG)</li>
<li>Raytheon Technologies Corporation (NYSE: RTX)</li>
<li>iShares 20+ Year Treasury Bond ETF (NASDAQ: TLT)</li>
</ol>
<p>Our approach involves the utilization of sophisticated financial models, which will be thoroughly explained later in this documentation. Furthermore, we leverage the power of various statistical and financial packages. We use th R programming language as our preferred tool for seamless portfolio optimization. Through a comprehensive analysis of historical data, we aim to evaluate and compare the performance of our portfolio against two benchmark index funds‚ÄîS&amp;P 500 and NASDAQ.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>üí° Detailed Background Overview: <a href="https://drive.google.com/file/d/1xbmX7GZ3pakPfEb3VJlRCiLe_34yudnt/view?usp=sharing">Pearl Fund</a></p>
</div>
</div>
<p>Once you‚Äôre familiarized with the code, feel free to explore and add your own curated collections of assets to see how they perform! To this make sure to enter the <em>exchange traded ticker symbols</em> to the <em>stock_tickers</em> vector in the second cell below. You must ensure that the assets you choose were traded on an exchange from a minimum of 2004 onward.</p>
<p>Before proceeding, ensure that the following libraries are installed and imported for seamless execution of the project:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(plotly)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyquant)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(corrplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(quantmod)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gganimate)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(PerformanceAnalytics)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(PortfolioAnalytics)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(DEoptim)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ROI)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tseries)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(TTR)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(fPortfolio)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(ROI.plugin.glpk)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(ROI.plugin.quadprog)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="equity-analysis" class="level1">
<h1>Equity Analysis</h1>
<p>Our analysis spans from January 1, 2004, until the latest market day close, providing a comprehensive view of various economic scenarios, including critical events such as the global financial crisis of 2008 and the SARS COVID-19 epidemic in 2020. We use the FRED economic data set to retrieve the most recent 10-year Treasury yields for our statistical testing we will run later.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stock_tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TLT"</span>, <span class="st">"MSFT"</span>, <span class="st">"HPQ"</span>, <span class="st">"COST"</span>, <span class="st">"F"</span>, <span class="st">"PEP"</span>, <span class="st">"JPM"</span>, <span class="st">"RTX"</span>, <span class="st">"PG"</span>, <span class="st">"CVX"</span>, <span class="st">"JNJ"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Treasury Yields (FRED)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ten_year_treasury_yield_table <span class="ot">=</span> <span class="fu">arrange</span>(<span class="fu">tq_get</span>(<span class="st">"DGS10"</span>, <span class="at">get =</span> <span class="st">"economic.data"</span>), <span class="fu">desc</span>(date))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>latest_ten_year_treasury_yield <span class="ot">=</span> <span class="fu">slice</span>(ten_year_treasury_yield_table, <span class="dv">1</span>)<span class="sc">$</span>price</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Latest 10-year Treasury Yield: "</span>,latest_ten_year_treasury_yield,<span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Latest 10-year Treasury Yield:  4.34 %</code></pre>
</div>
</div>
<section id="monthly-returns-table-view" class="level2">
<h2 class="anchored" data-anchor-id="monthly-returns-table-view">Monthly Returns (Table View)</h2>
<p>We proceed to collect our monthly stock returns using the tidyquant functions. We split this data set into two sets, one set ranging from 2004 to 5 years prior to the current date and another one from the previous 5 years. After some data pre-processing, we display the 5 most recent monthly returns for each of our stocks for the entire timeline below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_full_raw <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(stock_tickers, <span class="at">get  =</span> <span class="st">"stock.prices"</span>, <span class="at">from =</span> <span class="st">"2004-01-01"</span>, <span class="at">to =</span> <span class="fu">Sys.Date</span>())</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed Monthly Stock Returns (long format)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_full_long <span class="ot">=</span> stock_returns_monthly_full_raw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted, <span class="at">mutate_fun =</span> periodReturn, <span class="at">period =</span> <span class="st">"monthly"</span>, <span class="at">col_rename =</span> <span class="st">"MonthlyReturnsFull"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed Monthly Stock Returns (wide format)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_full_wide <span class="ot">=</span> <span class="fu">pivot_wider</span>(stock_returns_monthly_full_long, <span class="at">names_from=</span>symbol, <span class="at">values_from=</span>MonthlyReturnsFull)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly stock returns</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_full_wide_decreasing <span class="ot">=</span>  stock_returns_monthly_full_wide[<span class="fu">order</span>(stock_returns_monthly_full_wide<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">head</span>(stock_returns_monthly_full_wide_decreasing, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date         TLT         MSFT         HPQ        COST           F
1 2024-03-18 -0.01304786  0.008896607  0.06636740 -0.01660197 -0.02090026
2 2024-02-29 -0.02252203  0.042318377 -0.01323577  0.07210393  0.09007387
3 2024-01-31 -0.02245145  0.057281150 -0.04586244  0.05272086 -0.03855610
4 2023-12-29  0.08685759 -0.007574393  0.03496809  0.13893188  0.18810908
5 2023-11-30  0.09923885  0.122945401  0.11431823  0.07491814  0.05230767
           PEP        JPM          RTX          PG          CVX         JNJ
1  0.035804998 0.03547246  0.042266098  0.01428215  0.022367011 -0.02862815
2 -0.011441607 0.06710253 -0.009434506  0.01145477  0.042316332  0.02331857
3 -0.007713055 0.03136482  0.082956981  0.07910756 -0.011598336  0.01378068
4  0.009210248 0.08982576  0.032646025 -0.04546644  0.038718657  0.01344889
5  0.038542747 0.12239323  0.008485331  0.02326199 -0.004286768  0.05095416</code></pre>
</div>
</div>
<p>The data set below shows the last 5 monthly returns from 2004 to 5 years prior to today‚Äôs date.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw Stock Monthly Returns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_raw <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(stock_tickers, <span class="at">get  =</span> <span class="st">"stock.prices"</span>, <span class="at">from =</span> <span class="st">"2004-01-01"</span>, <span class="at">to =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">1815</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed Monthly Stock Returns (long format)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_long <span class="ot">=</span> stock_returns_monthly_raw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted, <span class="at">mutate_fun =</span> periodReturn, <span class="at">period =</span> <span class="st">"monthly"</span>, <span class="at">col_rename =</span> <span class="st">"MonthlyReturns"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed Monthly Stock Returns (wide format)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_wide <span class="ot">=</span> <span class="fu">pivot_wider</span>(stock_returns_monthly_long, <span class="at">names_from=</span>symbol, <span class="at">values_from=</span>MonthlyReturns)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly stock returns</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_wide_decreasing <span class="ot">=</span>  stock_returns_monthly_wide[<span class="fu">order</span>(stock_returns_monthly_wide<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">head</span>(stock_returns_monthly_wide_decreasing, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date          TLT        MSFT          HPQ        COST            F
1 2019-03-29  0.055716510  0.05275368 -0.006859819  0.10697622  0.001139899
2 2019-02-28 -0.013764005  0.07735739 -0.104403072  0.02190221 -0.003408788
3 2019-01-31  0.003785516  0.02815804  0.076735179  0.05360521  0.170367268
4 2018-12-31  0.058534979 -0.08404737 -0.104077808 -0.11920609 -0.187035129
5 2018-11-30  0.017872279  0.04268380 -0.047224674  0.01399552 -0.014659842
          PEP          JPM         RTX          PG         CVX         JNJ
1  0.05975446 -0.029992141  0.02562265  0.05580917  0.03010525  0.02305316
2  0.03468267  0.008308974  0.07069368  0.02156122  0.05348506  0.03356051
3  0.01982249  0.068843851  0.10884677  0.05780033  0.05386553  0.03122834
4 -0.08678637 -0.122043305 -0.12606692 -0.02740453 -0.08533730 -0.12151116
5  0.08506849  0.019904711 -0.01345501  0.06574192  0.07570479  0.05604301</code></pre>
</div>
</div>
<p>We repeat the above process for the 2nd batch of monthly stock returns which lasts for the last 5 years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_test_raw <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(stock_tickers, <span class="at">get  =</span> <span class="st">"stock.prices"</span>, <span class="at">from =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">1815</span>, <span class="at">to =</span> <span class="fu">Sys.Date</span>())</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_test_long <span class="ot">=</span> stock_returns_monthly_test_raw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted, <span class="at">mutate_fun =</span> periodReturn, <span class="at">period =</span> <span class="st">"monthly"</span>, <span class="at">col_rename =</span> <span class="st">"MonthlyReturns2nd"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_test_wide <span class="ot">=</span> <span class="fu">pivot_wider</span>(stock_returns_monthly_test_long, <span class="at">names_from=</span>symbol, <span class="at">values_from=</span>MonthlyReturns2nd)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_test_wide_decreasing <span class="ot">=</span>  stock_returns_monthly_test_wide[<span class="fu">order</span>(stock_returns_monthly_test_wide<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">head</span>(stock_returns_monthly_test_wide_decreasing, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date         TLT         MSFT         HPQ        COST           F
1 2024-03-18 -0.01304786  0.008896607  0.06636740 -0.01660197 -0.02090026
2 2024-02-29 -0.02252211  0.042318377 -0.01323577  0.07210393  0.09007387
3 2024-01-31 -0.02245129  0.057281150 -0.04586244  0.05272086 -0.03855610
4 2023-12-29  0.08685742 -0.007574393  0.03496809  0.13893188  0.18810908
5 2023-11-30  0.09923874  0.122945401  0.11431823  0.07491826  0.05230767
           PEP        JPM          RTX          PG          CVX         JNJ
1  0.035804998 0.03547246  0.042266098  0.01428215  0.022367011 -0.02862815
2 -0.011441607 0.06710253 -0.009434506  0.01145477  0.042316332  0.02331857
3 -0.007713055 0.03136482  0.082956981  0.07910756 -0.011598336  0.01378068
4  0.009210248 0.08982576  0.032646025 -0.04546644  0.038718657  0.01344889
5  0.038542747 0.12239323  0.008485235  0.02326199 -0.004286768  0.05095416</code></pre>
</div>
</div>
</section>
<section id="stock-growth-monthly-returns-graph-view" class="level2">
<h2 class="anchored" data-anchor-id="stock-growth-monthly-returns-graph-view"><strong>Stock Growth &amp; Monthly Returns (Graph View)</strong></h2>
<p>Displayed below is a graphical representation of the total returns (%) for our chosen stocks covering the chosen time period. To facilitate accurate time series analysis, the data has been standardized.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_raw1 <span class="ot">&lt;-</span> stock_returns_monthly_raw <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">return =</span> <span class="dv">100</span> <span class="sc">*</span> (close <span class="sc">-</span> <span class="fu">first</span>(close)) <span class="sc">/</span> <span class="fu">first</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, return, <span class="at">color =</span> symbol)) <span class="sc">+</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stock Performance Over Time Period"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Return (%)"</span>) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_raw1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The individual graphs below show the total return (to date) for each asset on their own scales.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_raw <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">return =</span> <span class="dv">100</span> <span class="sc">*</span> (close <span class="sc">-</span> <span class="fu">first</span>(close)) <span class="sc">/</span> <span class="fu">first</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, return, <span class="at">color =</span> symbol)) <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stock Performance Over Time Period"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Return (%) on a log scale"</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>symbol, <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Furthermore, within the same temporal framework, we present the monthly returns for our selected stocks. The graphical representation highlights the varying levels of volatility, with more erratic and spread-out patterns evident in stocks characterized by higher volatility.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_long <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, <span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>, <span class="at">color=</span>symbol)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> symbol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-metrics" class="level2">
<h2 class="anchored" data-anchor-id="statistical-metrics">Statistical Metrics</h2>
<p>We calculate the expected returns (based off historical returns), standard deviations, variance, and total count for each of our assets.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Stock_Statistics <span class="ot">=</span> stock_returns_monthly_long <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol)  <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Historic_Expected_Returns =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>), <span class="at">Standard_Deviation =</span> <span class="fu">sd</span>(<span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>), <span class="at">Variance =</span> <span class="fu">VAR</span>(<span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>), <span class="at">Count =</span> <span class="fu">n</span>())</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Stock_Statistics </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 √ó 5
   symbol Historic_Expected_Returns Standard_Deviation Variance Count
   &lt;chr&gt;                      &lt;dbl&gt;              &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
 1 COST                     0.0135              0.0527  0.00278   183
 2 CVX                      0.0103              0.0565  0.00319   183
 3 F                        0.00766             0.143   0.0204    183
 4 HPQ                      0.00819             0.0809  0.00654   183
 5 JNJ                      0.00858             0.0393  0.00154   183
 6 JPM                      0.0107              0.0764  0.00584   183
 7 MSFT                     0.0124              0.0649  0.00422   183
 8 PEP                      0.00838             0.0405  0.00164   183
 9 PG                       0.00731             0.0422  0.00178   183
10 RTX                      0.00876             0.0535  0.00286   183
11 TLT                      0.00581             0.0369  0.00136   183</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>animation1 <span class="ot">=</span> <span class="fu">ggplot</span>(Stock_Statistics, <span class="fu">aes</span>(<span class="at">x =</span> Standard_Deviation, <span class="at">y =</span> Historic_Expected_Returns, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">" Monthly Historic Risk-Return Tradeoff"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">"Volatility"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Expected Returns"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(animation1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ec3d989ed2ff32a17d60" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ec3d989ed2ff32a17d60">{"x":{"data":[{"x":[0.0527322031867841],"y":[0.0134925979151457],"text":"Standard_Deviation: 0.05273220<br />Historic_Expected_Returns: 0.013492598<br />symbol: COST","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"COST","legendgroup":"COST","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0564814780887822],"y":[0.0102988551496737],"text":"Standard_Deviation: 0.05648148<br />Historic_Expected_Returns: 0.010298855<br />symbol: CVX","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(219,142,0,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(219,142,0,1)"}},"hoveron":"points","name":"CVX","legendgroup":"CVX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.142856466319544],"y":[0.00766315840532351],"text":"Standard_Deviation: 0.14285647<br />Historic_Expected_Returns: 0.007663158<br />symbol: F","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(174,162,0,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(174,162,0,1)"}},"hoveron":"points","name":"F","legendgroup":"F","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0809011541813995],"y":[0.00818598338687919],"text":"Standard_Deviation: 0.08090115<br />Historic_Expected_Returns: 0.008185983<br />symbol: HPQ","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(100,178,0,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(100,178,0,1)"}},"hoveron":"points","name":"HPQ","legendgroup":"HPQ","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0392746517075693],"y":[0.00858347399377369],"text":"Standard_Deviation: 0.03927465<br />Historic_Expected_Returns: 0.008583474<br />symbol: JNJ","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,189,92,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,189,92,1)"}},"hoveron":"points","name":"JNJ","legendgroup":"JNJ","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0764367998617275],"y":[0.0106919681802726],"text":"Standard_Deviation: 0.07643680<br />Historic_Expected_Returns: 0.010691968<br />symbol: JPM","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,193,167,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,193,167,1)"}},"hoveron":"points","name":"JPM","legendgroup":"JPM","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0649313372833465],"y":[0.012398867577901],"text":"Standard_Deviation: 0.06493134<br />Historic_Expected_Returns: 0.012398868<br />symbol: MSFT","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,222,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,222,1)"}},"hoveron":"points","name":"MSFT","legendgroup":"MSFT","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0405140972652379],"y":[0.00837890964204367],"text":"Standard_Deviation: 0.04051410<br />Historic_Expected_Returns: 0.008378910<br />symbol: PEP","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,166,255,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,166,255,1)"}},"hoveron":"points","name":"PEP","legendgroup":"PEP","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0421689599640028],"y":[0.0073145003366694],"text":"Standard_Deviation: 0.04216896<br />Historic_Expected_Returns: 0.007314500<br />symbol: PG","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(179,133,255,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(179,133,255,1)"}},"hoveron":"points","name":"PG","legendgroup":"PG","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.053486743364141],"y":[0.00876348940746742],"text":"Standard_Deviation: 0.05348674<br />Historic_Expected_Returns: 0.008763489<br />symbol: RTX","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(239,103,235,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(239,103,235,1)"}},"hoveron":"points","name":"RTX","legendgroup":"RTX","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.0368907014659964],"y":[0.00581217098650239],"text":"Standard_Deviation: 0.03689070<br />Historic_Expected_Returns: 0.005812171<br />symbol: TLT","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,99,182,1)","opacity":1,"size":18.8976377952756,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,99,182,1)"}},"hoveron":"points","name":"TLT","legendgroup":"TLT","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":" Monthly Historic Risk-Return Tradeoff","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.031592413223319,0.148154754562221],"tickmode":"array","ticktext":["0.06","0.09","0.12"],"tickvals":[0.06,0.09,0.12],"categoryorder":"array","categoryarray":["0.06","0.09","0.12"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Volatility","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.00542814964007023,0.0138766192615778],"tickmode":"array","ticktext":["0.006","0.008","0.010","0.012"],"tickvals":[0.006,0.008,0.01,0.012],"categoryorder":"array","categoryarray":["0.006","0.008","0.010","0.012"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Expected Returns","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"symbol","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"5e1b625993d5":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"5e1b625993d5","visdat":{"5e1b625993d5":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><strong>Calculation of Excess Returns</strong></p>
<p>Moving forward, our analysis involves the computation of excess returns. This is achieved by subtracting our anticipated monthly return value from each historical monthly return value, resulting in an array of excess returns. This practice is widely adopted in risk-adjusted portfolio analysis to refine the assessment of portfolio performance.</p>
<p>Using our split data set, we calculate the historical expected mean from the first group and our excess returns using the monthly returns from the last 5 years with respect to the calculated expected returns to ensure the excess returns don‚Äôt contain future data priced in.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>excess_returns_table <span class="ot">&lt;-</span> stock_returns_monthly_test_long <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(Stock_Statistics, <span class="at">by =</span> <span class="st">"symbol"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Excess_Returns =</span> <span class="st">`</span><span class="at">MonthlyReturns2nd</span><span class="st">`</span> <span class="sc">-</span> Historic_Expected_Returns)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>excess_returns_table <span class="ot">&lt;-</span> excess_returns_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">`</span><span class="at">symbol</span><span class="st">`</span>, <span class="st">`</span><span class="at">date</span><span class="st">`</span>, <span class="st">`</span><span class="at">Excess_Returns</span><span class="st">`</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly excess stock returns</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>excess_returns_table_decreasing <span class="ot">=</span>  excess_returns_table[<span class="fu">order</span>(excess_returns_table<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(excess_returns_table_decreasing,<span class="fu">length</span>(stock_tickers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 √ó 3
# Groups:   symbol [11]
   symbol date       Excess_Returns
   &lt;chr&gt;  &lt;date&gt;              &lt;dbl&gt;
 1 TLT    2024-03-18       -0.0189 
 2 MSFT   2024-03-18       -0.00350
 3 HPQ    2024-03-18        0.0582 
 4 COST   2024-03-18       -0.0301 
 5 F      2024-03-18       -0.0286 
 6 PEP    2024-03-18        0.0274 
 7 JPM    2024-03-18        0.0248 
 8 RTX    2024-03-18        0.0335 
 9 PG     2024-03-18        0.00697
10 CVX    2024-03-18        0.0121 
11 JNJ    2024-03-18       -0.0372 </code></pre>
</div>
</div>
<p>We compute two matrices essential for our optimization process: the variance-covariance matrix and the correlation matrix. Each value within these matrices is derived from the following respective equations:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>üí° Calculation of the correlation matrix necessitates the input of the variance-covariance matrix</p>
</div>
</div>
<p><span class="math display">
Var-CoVar: \Sigma = \frac{X^T X}{n-1}
</span></p>
<p><span class="math display">
Corr: \frac{\Sigma}{\sigma^T \sigma}
</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>excess_returns_wider <span class="ot">=</span>  excess_returns_table <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> symbol, <span class="at">values_from =</span> Excess_Returns)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">as.matrix</span>(excess_returns_wider[ ,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance-Covariance Matrix</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variance-Covariance Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variance-Covariance Matrix</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">var</span>(M), <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         TLT   MSFT    HPQ   COST      F    PEP     JPM     RTX     PG     CVX
TLT   0.0022 0.0011 0.0002 0.0013 0.0006 0.0003 -0.0003 -0.0005 0.0001 -0.0008
MSFT  0.0011 0.0040 0.0026 0.0021 0.0032 0.0013  0.0018  0.0016 0.0012  0.0015
HPQ   0.0002 0.0026 0.0084 0.0016 0.0045 0.0013  0.0039  0.0031 0.0011  0.0035
COST  0.0013 0.0021 0.0016 0.0041 0.0037 0.0013  0.0014  0.0010 0.0012  0.0014
F     0.0006 0.0032 0.0045 0.0037 0.0171 0.0021  0.0064  0.0037 0.0011  0.0067
PEP   0.0003 0.0013 0.0013 0.0013 0.0021 0.0021  0.0014  0.0019 0.0016  0.0020
JPM  -0.0003 0.0018 0.0039 0.0014 0.0064 0.0014  0.0065  0.0042 0.0010  0.0050
RTX  -0.0005 0.0016 0.0031 0.0010 0.0037 0.0019  0.0042  0.0074 0.0017  0.0048
PG    0.0001 0.0012 0.0011 0.0012 0.0011 0.0016  0.0010  0.0017 0.0026  0.0010
CVX  -0.0008 0.0015 0.0035 0.0014 0.0067 0.0020  0.0050  0.0048 0.0010  0.0093
JNJ  -0.0001 0.0012 0.0012 0.0009 0.0015 0.0014  0.0016  0.0017 0.0013  0.0021
         JNJ
TLT  -0.0001
MSFT  0.0012
HPQ   0.0012
COST  0.0009
F     0.0015
PEP   0.0014
JPM   0.0016
RTX   0.0017
PG    0.0013
CVX   0.0021
JNJ   0.0024</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">=</span> <span class="fu">cor</span>(M)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Matrix with percentage </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Correlation Matrix as percentages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation Matrix as percentages</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(cor_mat <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         TLT    MSFT     HPQ    COST       F     PEP     JPM     RTX      PG
TLT  100.000  35.842   5.817  44.883  10.673  15.342  -7.346 -12.845   5.357
MSFT  35.842 100.000  45.846  51.514  39.485  44.252  35.511  29.832  37.324
HPQ    5.817  45.846 100.000  27.962  37.762  32.054  52.444  38.962  24.309
COST  44.883  51.514  27.962 100.000  44.728  44.217  26.540  17.660  35.221
F     10.673  39.485  37.762  44.728 100.000  35.504  61.046  32.734  16.498
PEP   15.342  44.252  32.054  44.217  35.504 100.000  38.843  47.241  67.462
JPM   -7.346  35.511  52.444  26.540  61.046  38.843 100.000  60.866  25.247
RTX  -12.845  29.832  38.962  17.660  32.734  47.241  60.866 100.000  37.344
PG     5.357  37.324  24.309  35.221  16.498  67.462  25.247  37.344 100.000
CVX  -17.916  24.219  39.735  22.026  53.042  44.369  63.913  57.958  19.748
JNJ   -5.135  38.110  25.718  27.999  23.067  63.610  41.401  39.104  49.764
         CVX     JNJ
TLT  -17.916  -5.135
MSFT  24.219  38.110
HPQ   39.735  25.718
COST  22.026  27.999
F     53.042  23.067
PEP   44.369  63.610
JPM   63.913  41.401
RTX   57.958  39.104
PG    19.748  49.764
CVX  100.000  44.973
JNJ   44.973 100.000</code></pre>
</div>
</div>
<p>We run a <em>Principal Component Analysis</em> calculation to display the groupings and correlations among the various assets in the pearl fund. The graph below displays the groups of closely related or correlated associations with certain stocks. The horizontal axis (Comp.1) and the vertical axis (Comp.2) represent the first two principal components derived from the PCA. These are the two dimensions that capture the most variance in the data set. From an investment standpoint, this plot might help in understanding which stocks move together (correlated), and potentially, it might help in identifying which stocks contribute most to the variance in the portfolio. This could be used for risk management and diversification; for instance, once might choose to invest in stocks that are less correlated with each other according to the PCA results. For example, the biplot shows that <strong><code>TLT</code></strong>, which is an ETF that tracks long-term treasury bonds, has a very different loading compared to other assets, indicating that its price movements are likely less correlated with those of the stocks.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">=</span> <span class="fu">princomp</span>(cor_mat, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pca_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">cor</span>(cor_mat, pca<span class="sc">$</span>scores))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>({pca_df <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Comp<span class="fl">.1</span>, <span class="at">y =</span> Comp<span class="fl">.2</span>)) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">label =</span> <span class="fu">rownames</span>(pca_df)) <span class="sc">+</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adding arrows from origin to points</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> Comp<span class="fl">.1</span>, <span class="at">yend =</span> Comp<span class="fl">.2</span>),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">"inches"</span>)),</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"blue"</span>, </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">subset</span>(pca_df, <span class="fu">rownames</span>(pca_df) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TLT"</span>, <span class="st">"MSFT"</span>, <span class="st">"HPQ"</span>, <span class="st">"COST"</span>, <span class="st">"F"</span>, <span class="st">"PEP"</span>, <span class="st">"JPM"</span>, <span class="st">"RTX"</span>, <span class="st">"PG"</span>, <span class="st">"CVX"</span>, <span class="st">"JNJ"</span>)),  <span class="co"># Add ticker symbols here</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">lineend =</span> <span class="st">"round"</span>)}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The following visuals will help aid the user with further understanding the correlations between the certain assets and larger groupings. Below we include a correlogram &amp; a heat-map. The correlogram displays the correlations of various stock pairs on a grid to display the direction (blue shows + and red shows -) and the intensity (increasing size/shade of dot shows a value closer to a magnitude of 1). A white box shows a correlation of 0, ruling out a linear association.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_mat, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The dendrogram below shows another display of correlation pairings as well as clustering of certain groups of assets to show similarities/relatedness.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(cor_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="benchmark-performance" class="level1">
<h1>Benchmark Performance</h1>
<p>Upon acquiring the historical monthly stock returns for our designated time frame, our focus shifts to the evaluation of the two ETFs of the comparison benchmark index funds‚ÄîSPDR S&amp;P 500 ETF Trust (NYSE: SPY) and NASDAQ COMPOSITE (NYSE: QQQ). We display the 5 most recent SPY &amp; NASDAQ Monthly returns available.</p>
<p><strong>S&amp;P 500 (Monthly % Returns):</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw S&amp;P 500 Monthly Returns</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_raw <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"SPY"</span>, <span class="at">get =</span> <span class="st">"stock.prices"</span>, <span class="at">from =</span> <span class="st">"2004-01-01"</span>, <span class="at">to =</span> <span class="st">"2024-01-01"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed S&amp;P 500 Monthly Returns</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly <span class="ot">=</span> <span class="fu">tq_transmute</span>(spy_returns_monthly_raw, <span class="at">select =</span> adjusted, <span class="at">mutate_fun =</span> periodReturn, <span class="at">period =</span> <span class="st">"monthly"</span>, <span class="at">col_rename =</span> <span class="st">"SPYMonthlyReturns"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforms data into percentages </span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_percentages <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">"date"</span> <span class="ot">=</span> spy_returns_monthly<span class="sc">$</span>date, <span class="st">"SPYPercentReturns"</span> <span class="ot">=</span> spy_returns_monthly<span class="sc">$</span>SPYMonthlyReturns <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly SPY returns (%)</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_percentages_decreasing <span class="ot">=</span>  spy_returns_monthly_percentages[<span class="fu">order</span>(spy_returns_monthly_percentages<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spy_returns_monthly_percentages_decreasing[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"SPYPercentReturns"</span>)], <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date SPYPercentReturns
240 2023-12-29          4.565537
239 2023-11-30          9.134381
238 2023-10-31         -2.170868
237 2023-09-29         -4.743442
236 2023-08-31         -1.625202</code></pre>
</div>
</div>
<p><strong>NASDAQ (Monthly % Returns):</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw NASDAQ Monthly Returns</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_raw <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(<span class="st">"QQQ"</span>, <span class="at">get =</span> <span class="st">"stock.prices"</span>, <span class="at">from =</span> <span class="st">"2004-01-01"</span>, <span class="at">to =</span> <span class="st">"2024-01-01"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed NASDAQ Monthly Returns</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly <span class="ot">=</span> <span class="fu">tq_transmute</span>(nasdaq_returns_monthly_raw, <span class="at">select =</span> adjusted, <span class="at">mutate_fun =</span> periodReturn, <span class="at">period =</span> <span class="st">"monthly"</span>, <span class="at">col_rename =</span> <span class="st">"NASDAQMonthlyReturns"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforms data into percentages </span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_percentages <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">"date"</span> <span class="ot">=</span> nasdaq_returns_monthly<span class="sc">$</span>date, <span class="st">"NASDAQPercentReturns"</span> <span class="ot">=</span> nasdaq_returns_monthly<span class="sc">$</span>NASDAQMonthlyReturns <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly NASDAQ returns (%)</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_percentages_decreasing <span class="ot">=</span>  nasdaq_returns_monthly_percentages[<span class="fu">order</span>(nasdaq_returns_monthly_percentages<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nasdaq_returns_monthly_percentages_decreasing[, <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"NASDAQPercentReturns"</span>)], <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date NASDAQPercentReturns
240 2023-12-29             5.586963
239 2023-11-30            10.818825
238 2023-10-31            -2.065488
237 2023-09-29            -5.079859
236 2023-08-31            -1.483012</code></pre>
</div>
</div>
<p>The line graph below illustrates the price trends over our time period for the benchmark returns ‚Äî SPY and QQQ. As before, we standardize the index prices to facilitate a more effective comparison.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining benchmark raw dataframes</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>benchmark_returns_raw <span class="ot">=</span> <span class="fu">rbind</span>(spy_returns_monthly_raw, nasdaq_returns_monthly_raw)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>benchmark_returns_raw <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">close =</span> <span class="dv">100</span><span class="sc">*</span>(close <span class="sc">-</span> <span class="fu">first</span>(close))<span class="sc">/</span><span class="fu">first</span>(close)) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, close, <span class="at">color=</span>symbol)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, we proceed to consolidate the returns of the two baseline index funds into a unified table. Additionally, a graph is presented to visually depict the combined returns of the two benchmarks within a single frame.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>benchmark_combined_table_of_returns <span class="ot">=</span> <span class="fu">left_join</span>(spy_returns_monthly, nasdaq_returns_monthly, <span class="at">by=</span><span class="st">"date"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>benchmark_long <span class="ot">=</span> benchmark_combined_table_of_returns <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">values_to =</span> <span class="st">"return"</span>, <span class="at">names_to =</span> <span class="st">"symbol"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(symbol)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>benchmark_long <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> return, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(symbol <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="portfolio-optimization" class="level1">
<h1>Portfolio Optimization</h1>
<p>The groundwork laid by our analysis and statistical metrics sets the stage for the upcoming portfolio optimization process. Drawing inspiration from the tenets of Modern Portfolio Theory (MPT), our objective is to optimize the portfolio of assets. Employing a mean-variance framework analysis, we seek to maximize expected returns for a specified level of risk tolerance, represented by standard deviation. We will also be utilizing other constraints and objectives to customize what we aim with our financial returns. Our approach involves leveraging concepts such as the efficient set mathematics, efficient frontier model, and other relevant methodologies.</p>
<p><strong>Equally Weighted Portfolio Initialization</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>init_weights <span class="ot">=</span> <span class="fu">rep</span>((<span class="dv">1</span><span class="sc">/</span><span class="fu">length</span>(stock_tickers)), <span class="fu">length</span>(stock_tickers))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>assets <span class="ot">=</span> <span class="fu">setNames</span>(init_weights, stock_tickers)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>assets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       TLT       MSFT        HPQ       COST          F        PEP        JPM 
0.09090909 0.09090909 0.09090909 0.09090909 0.09090909 0.09090909 0.09090909 
       RTX         PG        CVX        JNJ 
0.09090909 0.09090909 0.09090909 0.09090909 </code></pre>
</div>
</div>
<p>Next, using our optimization libraries we create a portfolio object where we will input our asset, initialized weights, portfolio constraints, and our objectives. Our desired outcome will be a vector of weights which optimizes for our objectives under our desired constraints.</p>
<p><em>Comments on Constraints</em></p>
<ol type="1">
<li>Weight Sum -&gt; sets a range of values for the total weight of out portfolio assets</li>
<li>Leverage -&gt; sets a range of values to depict additional borrowing</li>
<li>Box -&gt; sets a range of values for which the assets can be weighted at</li>
<li>Return -&gt; sets a target return rate for our portfolio to achieve</li>
</ol>
<p><em>Comments on Objectives</em></p>
<ol type="1">
<li>Return -&gt; aims to create a portfolio to maximize the return</li>
<li>Risk Aversion Parameter -&gt; sets the level of risk aversion for the optimization. A higher risk aversion value indicates a greater emphasis on minimizing risk in the portfolio.</li>
<li>Risk -&gt; aims to create a portfolio which minimizes the risk (StdDev, var, etc..)</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pearlfund <span class="ot">=</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> assets)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pearlfund)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = assets)

Number of assets: 11 
Asset Names
 [1] "TLT"  "MSFT" "HPQ"  "COST" "F"    "PEP"  "JPM"  "RTX"  "PG"   "CVX" 
More than 10 assets, only printing the first 10</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CONSTRAINTS</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>pearlfund <span class="ot">=</span> <span class="fu">add.constraint</span>(<span class="at">portfolio=</span>pearlfund, <span class="at">type=</span><span class="st">"weight_sum"</span>, <span class="at">min_sum=</span><span class="dv">1</span>, <span class="at">max_sum=</span><span class="dv">1</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pearlfund &lt;- add.constraint(portfolio=pearlfund, type="leverage", min_sum=0.99, max_sum=1.01)</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>pearlfund <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(<span class="at">portfolio=</span>pearlfund, <span class="at">type=</span><span class="st">"box"</span>, <span class="at">min=</span><span class="fl">0.00</span>, <span class="at">max=</span><span class="dv">1</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pearlfund = add.constraint(portfolio=pearlfund, type="return", return_target=0.0150)</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJECTIVES</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>pearlfund <span class="ot">=</span> <span class="fu">add.objective</span>(<span class="at">portfolio=</span>pearlfund, <span class="at">type=</span><span class="st">'return'</span>, <span class="at">name=</span><span class="st">'mean'</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>pearlfund <span class="ot">=</span> <span class="fu">add.objective</span>(<span class="at">portfolio =</span> pearlfund, <span class="at">type=</span><span class="st">'risk'</span>, <span class="at">name=</span><span class="st">"var"</span>, <span class="at">risk_aversion=</span><span class="dv">7</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># pearlfund = add.objective(pearlfund, type = "risk", name = "StdDev")</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># OPTIMIZE.PORTFOLIO</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>opt_maxret <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(<span class="at">R=</span>stock_returns_monthly_full_wide, <span class="at">portfolio=</span>pearlfund, <span class="at">optimize_method=</span><span class="st">"ROI"</span>, <span class="at">trace=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># OPTIMAL WEIGHTS</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt_maxret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = stock_returns_monthly_full_wide, portfolio = pearlfund, 
    optimize_method = "ROI", trace = TRUE)

Optimal Weights:
   TLT   MSFT    HPQ   COST      F    PEP    JPM    RTX     PG    CVX    JNJ 
0.2966 0.1328 0.0000 0.2159 0.0000 0.0137 0.0612 0.0000 0.1199 0.0808 0.0791 

Objective Measure:
    mean 
0.009853 


 StdDev 
0.02905 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VISUALIZATIONS</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(opt_maxret, <span class="at">risk.col=</span><span class="st">"StdDev"</span>, <span class="at">return.col=</span><span class="st">"mean"</span>, <span class="at">main=</span><span class="st">"Maximum Return Optimization"</span>, <span class="at">chart.assets=</span><span class="cn">TRUE</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.18</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.04</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Our visual above displays a line graph of the associated weights of our assets and a scatter plot comparing the mean vs.&nbsp;StdDev of the individual portfolio compared to the mean vs.&nbsp;StdDev of the portfolio as an aggregate whole.</p>
<p>The following code extracts the weights from our portfolio object and stores it as a vector of weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>optimized_list_of_weights <span class="ot">=</span> opt_maxret[<span class="dv">1</span>]<span class="sc">$</span>weights</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>optimized_vector_of_weights <span class="ot">=</span> <span class="fu">unlist</span>(optimized_list_of_weights)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>optimized_vector_of_weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         TLT         MSFT          HPQ         COST            F          PEP 
2.965686e-01 1.328087e-01 3.652409e-21 2.158549e-01 4.052203e-19 1.372430e-02 
         JPM          RTX           PG          CVX          JNJ 
6.119187e-02 5.797657e-18 1.199263e-01 8.084006e-02 7.908532e-02 </code></pre>
</div>
</div>
<section id="optimized-portfolio-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="optimized-portfolio-visualizations">Optimized Portfolio Visualizations</h2>
<section id="fund-total-growth-return" class="level3">
<h3 class="anchored" data-anchor-id="fund-total-growth-return">Fund Total Growth Return</h3>
<p>The visual below displays how much you would have right now if you had invested $10,000 at the start of the time period till today.</p>
<blockquote class="blockquote">
<p>*Please note that this does not account for tax consequences, which could reduce your final capital depending on tax policy and brackets</p>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Retstructuring</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearl Fund</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>aggregate_portfolio_monthly_returns_growth <span class="ot">&lt;-</span> stock_returns_monthly_long <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tq_portfolio</span>(<span class="at">assets_col =</span> symbol, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">returns_col=</span> <span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>, </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> optimized_vector_of_weights,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_rename   =</span> <span class="st">"investment.growth"</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wealth.index =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">investment.growth =</span> investment.growth <span class="sc">*</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_weights(weights, assets_col, map, x): Sum of weights must be 1.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearl Fund - Equally Weighted </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>equally_weighted_portfolio_monthly_returns_growth <span class="ot">&lt;-</span> stock_returns_monthly_long <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tq_portfolio</span>(<span class="at">assets_col =</span> symbol, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">returns_col=</span> <span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> init_weights,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_rename   =</span> <span class="st">"investment.growth"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wealth.index =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">investment.growth =</span> investment.growth <span class="sc">*</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_weights(weights, assets_col, map, x): Sum of weights must be 1.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SPY Portfolio</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>vals1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"SPY"</span>, <span class="dv">240</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_ticker <span class="ot">=</span> spy_returns_monthly</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_ticker<span class="sc">$</span>symbol <span class="ot">&lt;-</span> vals1</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>spy_returns_monthly_ticker_growth <span class="ot">&lt;-</span> spy_returns_monthly_ticker <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tq_portfolio</span>(<span class="at">assets_col =</span> symbol, </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">returns_col=</span> <span class="st">`</span><span class="at">SPYMonthlyReturns</span><span class="st">`</span>, </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_rename   =</span> <span class="st">"investment.growth"</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wealth.index =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">investment.growth =</span> investment.growth <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># NASDAQ Portfolio</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>vals2 <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">"NASDAQ"</span>, <span class="dv">240</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_ticker <span class="ot">=</span> nasdaq_returns_monthly</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_ticker<span class="sc">$</span>symbol <span class="ot">&lt;-</span> vals2</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>nasdaq_returns_monthly_ticker_growth <span class="ot">&lt;-</span> nasdaq_returns_monthly_ticker <span class="sc">%&gt;%</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tq_portfolio</span>(<span class="at">assets_col =</span> symbol, </span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">returns_col=</span> <span class="st">`</span><span class="at">NASDAQMonthlyReturns</span><span class="st">`</span>, </span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weights =</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col_rename   =</span> <span class="st">"investment.growth"</span>,</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wealth.index =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">investment.growth =</span> investment.growth <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearl Fund Portfolio Growth</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aggregate_portfolio_monthly_returns_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth)) <span class="sc">+</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Pearl Fund Portfolio Growth"</span>,</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Optimized Portfolio Growth"</span>,</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Performance growth over our 20-year horizon"</span>,</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Portfolio Value"</span>) <span class="sc">+</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SPY Portfolio Growth</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spy_returns_monthly_ticker_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"SPY Portfolio Growth"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Portfolio Growth"</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Performance growth over our 20-year horizon"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Portfolio Value"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NASDAQ Portfolio Growth</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nasdaq_returns_monthly_ticker_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NASDAQ Portfolio Growth"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Portfolio Growth"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Performance growth over our 20-year horizon"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Portfolio Value"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fund-monthly-returns" class="level3">
<h3 class="anchored" data-anchor-id="fund-monthly-returns">Fund Monthly Returns</h3>
<p>The following visual displays a scatter plot of the monthly returns throughout the time period of interest. A trend line (using ‚Äúloess‚Äù) is fitted onto the graph to display the variation and direction at different regions of the scatter plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>aggregate_portfolio_monthly_returns <span class="ot">=</span> stock_returns_monthly_long <span class="sc">%&gt;%</span> <span class="fu">tq_portfolio</span>(<span class="at">assets_col =</span> symbol, <span class="at">returns_col =</span> <span class="st">`</span><span class="at">MonthlyReturns</span><span class="st">`</span>, <span class="at">weights =</span> optimized_vector_of_weights, <span class="at">col_rename =</span> <span class="st">"AggregateMonthlyReturns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_weights(weights, assets_col, map, x): Sum of weights must be 1.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>aggregate_portfolio_monthly_returns <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> <span class="st">`</span><span class="at">AggregateMonthlyReturns</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Pearl Fund Portfolio Returns"</span>, <span class="at">subtitle =</span> <span class="st">"Optimized Portfolio"</span>, <span class="at">caption =</span> <span class="st">"Shows an above-zero trend indicating long-term positive returns"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Monthly Returns"</span>) <span class="sc">+</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tq</span>() <span class="sc">+</span> <span class="fu">scale_color_tq</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="annualized-returns" class="level3">
<h3 class="anchored" data-anchor-id="annualized-returns">Annualized Returns</h3>
<p>To get a better appreciation for the fund‚Äôs return, we proceed to annualize the the monthly returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>portfolio_monthly_mean <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(opt_maxret[<span class="dv">2</span>]<span class="sc">$</span>objective_measures<span class="sc">$</span>mean))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to annualized % return</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>annualized_return <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="dv">100</span><span class="sc">*</span>((<span class="dv">1</span> <span class="sc">+</span> portfolio_monthly_mean)<span class="sc">^</span><span class="dv">12</span> <span class="sc">-</span> <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(annualized_return) <span class="ot">=</span> <span class="st">"Annualized Return"</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Annualized Return:"</span>, annualized_return)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Annualized Return: 12.4864553377463%</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="comparative-statistical-analysis" class="level1">
<h1>Comparative Statistical Analysis</h1>
<p>To objectively test our portfolio, we will be calculating several financial metrics in relation to both our benchmarks ‚Äî SPY &amp; QQQ.</p>
<dl>
<dt>Valuable tq_performance tests‚Ä¶</dt>
<dd>
<p><em>table.Stats, table.CAPM, table.AnnualizedReturns, table.Correlation, table.DownsideRisk, table.DownsideRiskRatio, table.HigherMoments, table.InformationRatio, table.Variability, VaR, SharpeRatio</em></p>
</dd>
</dl>
<p>To begin, it is important to combine the benchmark index monthly returns with our portfolio monthly returns.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio + S&amp;P500 Table</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>spy_combined_table_of_returns <span class="ot">=</span> <span class="fu">left_join</span>(aggregate_portfolio_monthly_returns, spy_returns_monthly, <span class="at">by=</span><span class="st">"date"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio + NASDAQ Table</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>nasdaq_combined_table_of_returns <span class="ot">=</span> <span class="fu">left_join</span>(aggregate_portfolio_monthly_returns, nasdaq_returns_monthly, <span class="at">by=</span><span class="st">"date"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Displays the most recent 5 monthly returns for the tables above</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>spy_combined_table_of_returns_decreasing <span class="ot">=</span>  spy_combined_table_of_returns[<span class="fu">order</span>(spy_combined_table_of_returns<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spy_combined_table_of_returns_decreasing, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
  date       AggregateMonthlyReturns SPYMonthlyReturns
  &lt;date&gt;                       &lt;dbl&gt;             &lt;dbl&gt;
1 2019-03-29                  0.0655            0.0181
2 2019-02-28                  0.0282            0.0324
3 2019-01-31                  0.0403            0.0801
4 2018-12-31                 -0.0781           -0.0880
5 2018-11-30                  0.0319            0.0185</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nasdaq_combined_table_of_returns_decreasing <span class="ot">=</span>  nasdaq_combined_table_of_returns[<span class="fu">order</span>(nasdaq_combined_table_of_returns<span class="sc">$</span>date, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nasdaq_combined_table_of_returns_decreasing, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
  date       AggregateMonthlyReturns NASDAQMonthlyReturns
  &lt;date&gt;                       &lt;dbl&gt;                &lt;dbl&gt;
1 2019-03-29                  0.0655              0.0392 
2 2019-02-28                  0.0282              0.0299 
3 2019-01-31                  0.0403              0.0901 
4 2018-12-31                 -0.0781             -0.0866 
5 2018-11-30                  0.0319             -0.00265</code></pre>
</div>
</div>
<p>The following code combines all the funds of interest that intend to be comparing into a single table (wide format) once again with the 5 most recent returns displayed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined Table (3 Funds)</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>three_fund_combined_table_of_returns <span class="ot">=</span> <span class="fu">left_join</span>(spy_combined_table_of_returns, nasdaq_returns_monthly, <span class="at">by=</span><span class="st">"date"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>three_fund_combined_table_of_returns_decreasing <span class="ot">&lt;-</span> <span class="fu">arrange</span>(three_fund_combined_table_of_returns, <span class="fu">desc</span>(date))</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(three_fund_combined_table_of_returns_decreasing, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 4
  date       AggregateMonthlyReturns SPYMonthlyReturns NASDAQMonthlyReturns
  &lt;date&gt;                       &lt;dbl&gt;             &lt;dbl&gt;                &lt;dbl&gt;
1 2019-03-29                  0.0655            0.0181              0.0392 
2 2019-02-28                  0.0282            0.0324              0.0299 
3 2019-01-31                  0.0403            0.0801              0.0901 
4 2018-12-31                 -0.0781           -0.0880             -0.0866 
5 2018-11-30                  0.0319            0.0185             -0.00265</code></pre>
</div>
</div>
<p>This is a great display of a side by side view of the monthly returns for our three funds of comparison for our time period of interest. The following visuals are a great measure of the overall volatility of our portfolio compared to the two benchmarks. Graphs that display more ‚Äúups‚Äù and ‚Äúdowns‚Äù with monthly returns indicate larger deviations from the mean. Given similar annualized returns and expected long term value, a risk-averse investor should prefer the portfolios/funds which minimize the volatility/risk for the given time period.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>three_fund_long <span class="ot">=</span> three_fund_combined_table_of_returns <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">values_to =</span> <span class="st">"return"</span>, <span class="at">names_to =</span> <span class="st">"symbol"</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(symbol)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>three_fund_long <span class="sc">|&gt;</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> return, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(symbol <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The tq_performance function in tidyquant allows us to produce statistical metrics for financial analysis for our Peal Fund against each of the benchmark index funds.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearl Fund vs. SPY</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>statisticsA <span class="ot">=</span> spy_combined_table_of_returns <span class="sc">%&gt;%</span> <span class="fu">tq_performance</span>(<span class="at">Ra =</span> <span class="st">`</span><span class="at">AggregateMonthlyReturns</span><span class="st">`</span>, <span class="at">Rb =</span> <span class="st">`</span><span class="at">SPYMonthlyReturns</span><span class="st">`</span>, <span class="at">performance_fun =</span> table.CAPM)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearl Fund vs. NASDAQ</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>statisticsB <span class="ot">=</span> nasdaq_combined_table_of_returns <span class="sc">%&gt;%</span> <span class="fu">tq_performance</span>(<span class="at">Ra =</span> <span class="st">`</span><span class="at">AggregateMonthlyReturns</span><span class="st">`</span>, <span class="at">Rb =</span> <span class="st">`</span><span class="at">NASDAQMonthlyReturns</span><span class="st">`</span>, <span class="at">performance_fun =</span> table.CAPM)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(statisticsA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  ActivePremium  Alpha AnnualizedAlpha  Beta  Beta-  Beta+ Correlation
1        0.0268 0.0055          0.0675 0.498 0.5017 0.4153      0.7008
  Correlationp-value InformationRatio R-squared TrackingError TreynorRatio
1                  0           0.2783    0.4912        0.0963       0.2235</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(statisticsB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  ActivePremium  Alpha AnnualizedAlpha   Beta Beta- Beta+ Correlation
1       -0.0084 0.0055          0.0681 0.3477 0.318 0.288      0.6162
  Correlationp-value InformationRatio R-squared TrackingError TreynorRatio
1                  0          -0.0623    0.3797        0.1342       0.3202</code></pre>
</div>
</div>
<hr>
</section>
<section id="mean-variance-analysis-efficient-frontier" class="level1">
<h1>Mean-Variance Analysis (Efficient Frontier)</h1>
<p>The efficient frontier is a concept in financial portfolio theory that represents the set of optimal portfolios that offer the highest expected return for a given level of risk, or the lowest risk for a given level of expected return. It is useful for investors and portfolio managers as it helps identify the optimal balance between risk and return, enabling them to construct portfolios that maximize potential gains while minimizing exposure to volatility.</p>
<p>To apply this framework to our portfolio, we first need to modify our monthly stock returns table so that the date column is removed with once again the 5 most recent returns displayed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_wide_dateless <span class="ot">=</span> stock_returns_monthly_wide[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>stock_returns_monthly_wide_decreasing <span class="ot">&lt;-</span> <span class="fu">arrange</span>(stock_returns_monthly_wide, <span class="fu">desc</span>(date))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stock_returns_monthly_wide_decreasing[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 11
       TLT    MSFT      HPQ    COST        F     PEP      JPM     RTX      PG
     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1  0.0557   0.0528 -0.00686  0.107   0.00114  0.0598 -0.0300   0.0256  0.0558
2 -0.0138   0.0774 -0.104    0.0219 -0.00341  0.0347  0.00831  0.0707  0.0216
3  0.00379  0.0282  0.0767   0.0536  0.170    0.0198  0.0688   0.109   0.0578
4  0.0585  -0.0840 -0.104   -0.119  -0.187   -0.0868 -0.122   -0.126  -0.0274
5  0.0179   0.0427 -0.0472   0.0140 -0.0147   0.0851  0.0199  -0.0135  0.0657
# ‚Ñπ 2 more variables: CVX &lt;dbl&gt;, JNJ &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The next step is to simulate, using a loop, a series of random weights which we then apply certain matrices to. The result is a data frame which stores the list of returns and risk values for portfolios of different weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>np1 <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>ret2 <span class="ot">=</span> stock_returns_monthly_wide_dateless  <span class="co">#excluding dates</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">=</span> <span class="fu">colMeans</span>(ret2)  <span class="co">#mean returns</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>na1 <span class="ot">=</span> <span class="fu">ncol</span>(ret2)  <span class="co">#number of assets</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>varc1 <span class="ot">=</span> <span class="fu">cov</span>(ret2)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>riskp1 <span class="ot">=</span> <span class="cn">NULL</span>  <span class="co">#vector to store risk</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>retp1 <span class="ot">=</span> <span class="cn">NULL</span>  <span class="co">#vector to store returns</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># using loops here (not aiming for efficiency but demonstration)</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>np1) {</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">=</span> <span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">sort</span>(<span class="fu">runif</span>(na1 <span class="sc">-</span> <span class="dv">1</span>)), <span class="dv">1</span>))  <span class="co"># random weights</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    r1 <span class="ot">=</span> <span class="fu">t</span>(w) <span class="sc">%*%</span> mu1  <span class="co">#matrix multiplication</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    sd1 <span class="ot">=</span> <span class="fu">t</span>(w) <span class="sc">%*%</span> varc1 <span class="sc">%*%</span> w</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    retp1 <span class="ot">=</span> <span class="fu">rbind</span>(retp1, r1)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    riskp1 <span class="ot">=</span> <span class="fu">rbind</span>(riskp1, sd1)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co"># create a data frame of risk and return</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>d_p1 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Ret =</span> retp1, <span class="at">Risk =</span> riskp1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We use ggplot to and to visualize the data accordingly and as expected we achieve the curve as derived from the Modern Portfolio Framework.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(d_p1, <span class="fu">aes</span>(Risk, Ret, <span class="at">colour =</span> Ret))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> p1 <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with density and identified port risk return (highest</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># lowest returns and min risk)</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fu">max</span>(d_p1<span class="sc">$</span>Ret), <span class="fu">median</span>(d_p1<span class="sc">$</span>Ret),</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">min</span>(d_p1<span class="sc">$</span>Ret)), <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"darkgray"</span>, <span class="st">"darkred"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> d_p1[(d_p1<span class="sc">$</span>Risk <span class="sc">==</span> <span class="fu">min</span>(d_p1<span class="sc">$</span>Risk)), ][, <span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Portfolio Return"</span>, <span class="at">x =</span> <span class="st">"Portfolio Risk"</span>, <span class="at">y =</span> <span class="st">"Portfolio Return"</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Random Feasible Portfolios"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here is another display of our plot using a different R frontier calculation package. To choose what you‚Äôd like to plot exactly in plot(), enter values from below as a vector:</p>
<blockquote class="blockquote">
<p><em>Syntax for choosing vector in plot function below:</em></p>
<ol type="1">
<li>Efficient Frontier</li>
<li>Global Minimum Variance Portfolio</li>
<li>Tangent (optimal portfolio)</li>
<li>Risk/Return of each asset</li>
<li>Equal Weights Portfolio</li>
<li>Two Asset Frontier</li>
<li>Monte Carlo</li>
<li>Sharpe Ratio</li>
</ol>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>return.matrix <span class="ot">=</span> <span class="fu">as.timeSeries</span>(stock_returns_monthly_wide[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>efficient.frontier <span class="ot">=</span> <span class="fu">portfolioFrontier</span>(return.matrix, <span class="st">`</span><span class="at">setRiskFreeRate&lt;-</span><span class="st">`</span>(<span class="fu">portfolioSpec</span>(), (latest_ten_year_treasury_yield<span class="sc">/</span><span class="dv">100</span>)<span class="sc">/</span><span class="dv">12</span>), <span class="at">constraints =</span> <span class="st">"LongOnly"</span> )</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(efficient.frontier, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(efficient.frontier, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-33-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Optimal portfolios for a given target risk are displayed by the dark colored dots on the border or <em>frontier</em> of the Monte-Carlo simulated data points. The capital allocation line (blue line) which intersects the efficient frontier at a point of tangency indicating the <em>optimal portfolio</em> for an investor at the current risk-free rate (10 year yield on government bond).</p>
<p>The following visual is another very useful metric to understand portfolio weightings based on chosen return/risk levels.</p>
<blockquote class="blockquote">
<p><strong>Interpretation</strong></p>
<p><em>Pick a vertical line/column at a specified target return and target risk and you can find out the allocations of stocks in your portfolio (through the lengths of the appropriate colored bars) to achieve those chosen metrics.</em></p>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weightsPlot</span>(efficient.frontier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here our goal is to produce a different type of frontier visual. Instead of plotting the traditional measures of risk (standard deviation or variance) against returns, we turn to a different measure of risk ‚Äî <em>expected tail loss (ETL).</em> ETL is a another measure of risk which could be a better use in portfolio optimization in certain situations.</p>
<blockquote class="blockquote">
<p>ETL, also known as conditional value at risk (CVaR), is a risk measure that quantifies the expected loss in the tail of a distribution of possible outcomes beyond a certain confidence level. ETL focuses specifically on the extreme or tail events, giving an indication of the potential loss in those extreme scenarios. The preference for ETL over variance in some cases arises because ETL puts more emphasis on extreme events, which can be crucial in risk assessment. Variance might not adequately capture the potential impact of rare but severe events, whereas ETL provides a clearer picture of the expected loss in the tail of the distribution.</p>
</blockquote>
<p>The following code generates a series of ETL values for each of our portfolio weights at a chosen confidence level (95%).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>confidence_level <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>np1 <span class="ot">&lt;-</span> <span class="fu">length</span>(retp1)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>cvar_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(np1)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>returns <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="fu">mean</span>(retp1), <span class="fu">mean</span>(riskp1))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>etl_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(np1)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>np1) {</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  random_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(returns, <span class="fu">length</span>(returns), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  sorted_returns <span class="ot">&lt;-</span> <span class="fu">sort</span>(random_sample, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  tail_index <span class="ot">&lt;-</span> <span class="fu">floor</span>((<span class="dv">1</span> <span class="sc">-</span> confidence_level) <span class="sc">*</span> <span class="fu">length</span>(returns))</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  tail_returns <span class="ot">&lt;-</span> sorted_returns[<span class="dv">1</span><span class="sc">:</span>tail_index]</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  etl_values[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(tail_returns)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We add these ETL values to our data frame of Returns and Risk for our various portfolios.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add ETL to this table</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>d_p1 <span class="ot">=</span> <span class="fu">mutate</span>(d_p1, <span class="at">ETL =</span> etl_values)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d_p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Ret         Risk        ETL
1 0.009231216 0.0022009310 0.01257818
2 0.008707594 0.0014687429 0.01283904
3 0.008848691 0.0008368538 0.01247632
4 0.009423036 0.0017632337 0.01257605
5 0.008741978 0.0008614042 0.01258436
6 0.010092216 0.0021418932 0.01274313</code></pre>
</div>
</div>
<p>Finally, we plot these ETL values against our return values for our portfolios and are able to visualize the results. By plotting ETL vs.&nbsp;Expected Return, you can assess whether the expected returns of the portfolio adequately compensates for the potential magnitude of extreme losses.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(d_p1, <span class="fu">aes</span>(ETL, Ret, <span class="at">colour =</span> Ret)) <span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fu">max</span>(d_p1<span class="sc">$</span>Ret), <span class="fu">median</span>(d_p1<span class="sc">$</span>Ret), <span class="fu">min</span>(d_p1<span class="sc">$</span>Ret)),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"darkgray"</span>, <span class="st">"darkred"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> d_p1[(d_p1<span class="sc">$</span>Risk <span class="sc">==</span> <span class="fu">min</span>(d_p1<span class="sc">$</span>Risk)), ][, <span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Portfolio Return"</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Expected Tail Loss"</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Portfolio Return"</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Random Feasible Portfolios"</span>) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">xlim</span>(<span class="fu">min</span>(d_p1<span class="sc">$</span>ETL), <span class="fu">max</span>(d_p1<span class="sc">$</span>ETL)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">min</span>(d_p1<span class="sc">$</span>Ret), <span class="fu">max</span>(d_p1<span class="sc">$</span>Ret))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_vline()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>To conclude, we plot the Optimized Pearl Fund Portfolio (in red) versus the Equally Weighted Pearl Fund Portfolio (in blue). As evident in the graph below, the Optimized Portfolio generates higher returns than the Equally Weighted Portfolio, while rising more steadily.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> aggregate_portfolio_monthly_returns_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth), </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> aggregate_portfolio_monthly_returns_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth), </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> equally_weighted_portfolio_monthly_returns_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth), </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> equally_weighted_portfolio_monthly_returns_growth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> investment.growth), </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Pearl Fund Optimized Portfolio Growth vs. Equally Weighted Portfolio"</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> ,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Performance growth over our 20-year horizon"</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Portfolio Value"</span>) <span class="sc">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar) <span class="sc">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="pearl_fund_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>